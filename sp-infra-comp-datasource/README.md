# sp-infra-comp-core

    1.提供了@DataSource注解定义多个数据源对象并托管到Spring容器中；
    2.提供了DynamicDataSourceHolders可以从数据源缓存池获取/放入数据源对象
    
## 引用依赖

如果项目使用这个工具包，它只需要引入以下maven的依赖项。

```xml
<dependency>
    <groupId>com.sp.infra.comp</groupId>
    <artifactId>sp-infra-comp-datasource</artifactId>
    <version>1.0.0-SNAPSHOT</version>
</dependency>
```

## 配置动态多个数据源

```yaml
spring:
  datasource:
    master:
      driverClassName: com.mysql.jdbc.Driver
      druid:
        filters: stat
        initialSize: 10
        maxActive: 20
        maxOpenPreparedStatements: 20
        maxWait: 60000
        minEvictableIdleTimeMillis: 300000
        minIdle: 1
        poolPreparedStatements: true
        testOnBorrow: true
        testOnReturn: false
        testWhileIdle: true
        timeBetweenEvictionRunsMillis: 60000
        validationQuery: SELECT 1
      password: Ho5E9G3p96bo
      type: com.alibaba.druid.pool.DruidDataSource
      url: jdbc:mysql://10.19.187.125:3306/employee_center?autoReconnect=true&zeroDateTimeBehavior=convertToNull&useUnicode=true&allowMultiQueries=true&characterEncoding=utf-8
      username: yhhy_stage
    slave:
      driverClassName: com.mysql.jdbc.Driver
      filters: stat
      initialSize: 10
      maxActive: 20
      maxOpenPreparedStatements: 20
      maxWait: 60000
      minEvictableIdleTimeMillis: 300000
      minIdle: 1
      password: Ho5E9G3p96bo
      poolPreparedStatements: true
      testOnBorrow: true
      testOnReturn: false
      testWhileIdle: true
      timeBetweenEvictionRunsMillis: 60000
      type: com.alibaba.druid.pool.DruidDataSource
      url: jdbc:mysql://10.19.187.125:3306/employee_center?autoReconnect=true&zeroDateTimeBehavior=convertToNull&useUnicode=true&allowMultiQueries=true&characterEncoding=utf-8
      username: yhhy_stage
      validationQuery: SELECT 1

```

# 使用方法
## Mapper方法中使用
###指定使用某个数据源类型做DB操作
```java
package com.yonghui.product.mapper;

import com.yonghui.common.datasource.DataSource;
import com.yonghui.product.dto.BagQueryParams;
import com.yonghui.product.model.Bag;
import org.apache.ibatis.annotations.Param;

import java.util.List;

public interface BagMapper {
    /**
     * This method was generated by MyBatis Generator.
     * This method corresponds to the database table t_bag
     *
     * @mbg.generated
     */
    int deleteByPrimaryKey(Long pid);

    /**
     * This method was generated by MyBatis Generator.
     * This method corresponds to the database table t_bag
     *
     * @mbg.generated
     */
    int insert(Bag record);

    /**
     * This method was generated by MyBatis Generator.
     * This method corresponds to the database table t_bag
     *
     * @mbg.generated
     */
    int insertSelective(Bag record);

    /**
     * This method was generated by MyBatis Generator.
     * This method corresponds to the database table t_bag
     *
     * @mbg.generated
     */
    Bag selectByPrimaryKey(Long pid);

    /**
     * This method was generated by MyBatis Generator.
     * This method corresponds to the database table t_bag
     *
     * @mbg.generated
     */
    int updateByPrimaryKeySelective(Bag record);

    /**
     * This method was generated by MyBatis Generator.
     * This method corresponds to the database table t_bag
     *
     * @mbg.generated
     */
    int updateByPrimaryKey(Bag record);

    @DataSource("slave")
    List<Bag> selectBagByShopId(@Param("shopId") String shopId);

    @DataSource("slave")
    List<Bag> findBagByPage(BagQueryParams params);


    @DataSource("slave")
    int countBag(BagQueryParams params);
}
```



